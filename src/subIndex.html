<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AdSDK v·ªõi Callback Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #333;
      margin-bottom: 24px;
    }
    
    .panel {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .panel h3 {
      margin-top: 0;
      color: #555;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 8px;
    }
    
    #ad-slot {
      width: 100%;
      height: 250px;
      border: 2px dashed #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fafafa;
      color: #999;
      font-size: 14px;
    }
    
    .controls {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    button:hover {
      background: #45a049;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    button.secondary {
      background: #2196F3;
    }
    
    button.secondary:hover {
      background: #0b7dda;
    }
    
    button.danger {
      background: #f44336;
    }
    
    button.danger:hover {
      background: #da190b;
    }
    
    .log-panel {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 16px;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .log-entry {
      margin-bottom: 8px;
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }
    
    .log-time {
      color: #858585;
      margin-right: 8px;
    }
    
    .log-success {
      color: #4EC9B0;
    }
    
    .log-error {
      color: #f48771;
    }
    
    .log-delay {
      color: #DCDCAA;
    }
    
    .log-fallback {
      color: #CE9178;
    }
    
    .status-box {
      padding: 12px;
      border-radius: 4px;
      margin-top: 12px;
      display: none;
    }
    
    .status-box.show {
      display: block;
    }
    
    .status-box.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-box.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-box.delay {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .video-container {
      position: relative;
      width: 100%;
      height: 450px;
      background: #000;
      border-radius: 4px;
      overflow: hidden;
    }
    
    #video-demo {
      width: 100%;
      height: 100%;
    }
    
    #video-ad-slot {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 640px;
      height: 90px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 14px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>üéØ AdSDK v·ªõi Callback Pattern Demo</h1>
  
  <!-- Panel 1: Banner Tƒ©nh -->
  <div class="panel">
    <h3>1Ô∏è‚É£ Banner Tƒ©nh (Display Banner)</h3>
    <div id="ad-slot">Ch·ªù hi·ªÉn th·ªã qu·∫£ng c√°o...</div>
    
    <div class="controls">
      <button id="btn-load-ad">T·∫£i Qu·∫£ng C√°o</button>
      <button id="btn-dismiss" class="danger">Dismiss</button>
    </div>
    
    <div id="status-static" class="status-box"></div>
  </div>
  
  <!-- Panel 2: Video v·ªõi Overlay -->
  <div class="panel">
    <h3>2Ô∏è‚É£ Video v·ªõi Overlay Banner (Pause ƒë·ªÉ hi·ªán)</h3>
    <div class="video-container">
      <video id="video-demo" controls>
        <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
      </video>
      <div id="video-ad-slot">Video Ad Slot</div>
    </div>
    
    <div id="status-video" class="status-box"></div>
  </div>
  
  <!-- Panel 3: Event Log -->
  <div class="panel">
    <h3>3Ô∏è‚É£ Event Log & Callback Results</h3>
    <div class="log-panel" id="log"></div>
  </div>
</div>

<!-- Load SDK -->
<script src="/dist/ad-sdk.min.js"></script>

<script>
  // Logging utility
  const logEl = document.getElementById('log');
  
  function addLog(message, type = 'info') {
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    
    let className = '';
    if (type === 'success') className = 'log-success';
    else if (type === 'error') className = 'log-error';
    else if (type === 'delay') className = 'log-delay';
    else if (type === 'fallback') className = 'log-fallback';
    
    entry.innerHTML = `<span class="log-time">[${time}]</span><span class="${className}">${message}</span>`;
    logEl.insertBefore(entry, logEl.firstChild);
    
    console.log(`[${time}]`, message);
  }
  
  // Show status box
  function showStatus(elementId, status, message) {
    const box = document.getElementById(elementId);
    box.className = `status-box show ${status}`;
    box.textContent = message;
    
    setTimeout(() => {
      box.classList.remove('show');
    }, 5000);
  }
  
  // Initialize SDK
  window.sdk = new AdSDK({
    env: AdSDK.ENV.SANDBOX,
    type: AdSDK.TYPE.DISPLAY,
    debug: true,
    tenantId: 14,
    streamId: "123456",
    channelId: "654321",
    title: "Demo Video",
    transId: "demo_001",
    category: "entertainment",
    keyword: "test, demo",
    age: "25",
    gender: AdSDK.GENDER.MALE,
  });
  
  addLog('‚úÖ SDK initialized successfully', 'success');
  
  // Button: Load Ad
  document.getElementById('btn-load-ad').addEventListener('click', () => {
    addLog('üîÑ ƒêang t·∫£i qu·∫£ng c√°o...');
    
    window.sdk.start("ad-slot", "DISPLAY", "HOMEPAGE_LARGE_BANNER", "homepage1", (result) => {
      console.log('üì¶ Callback received:', result);
      
      if (result.status === 'success') {
        addLog(`‚úÖ Qu·∫£ng c√°o hi·ªÉn th·ªã th√†nh c√¥ng! (domId: ${result.domId})`, 'success');
        showStatus('status-static', 'success', '‚úÖ Qu·∫£ng c√°o ƒë√£ ƒë∆∞·ª£c t·∫£i v√† hi·ªÉn th·ªã th√†nh c√¥ng!');
        
        // Log th√¥ng tin chi ti·∫øt
        if (result.data) {
          addLog(`üìä Banner Source: ${result.data.bannerSource}`);
          addLog(`üìê Size: ${result.data.ratioWidth}x${result.data.ratioHeight}`);
        }
        
      } else if (result.status === 'error') {
        addLog(`‚ùå L·ªói khi t·∫£i qu·∫£ng c√°o: ${result.error.message}`, 'error');
        showStatus('status-static', 'error', `‚ùå L·ªói: ${result.error.message}`);
        
      } else if (result.status === 'delay') {
        addLog(`‚è≥ Qu·∫£ng c√°o trong th·ªùi gian delay: ${result.data.remainingSeconds}s`, 'delay');
        showStatus('status-static', 'delay', `‚è≥ Vui l√≤ng ƒë·ª£i ${result.data.remainingSeconds} gi√¢y`);
        
      } else if (result.status === 'fallback') {
        addLog(`‚ö†Ô∏è Hi·ªÉn th·ªã fallback: Kh√¥ng c√≥ qu·∫£ng c√°o kh·∫£ d·ª•ng`, 'fallback');
        showStatus('status-static', 'error', '‚ö†Ô∏è Kh√¥ng c√≥ qu·∫£ng c√°o kh·∫£ d·ª•ng');
      }
    });
  });
  
  // Button: Dismiss
  document.getElementById('btn-dismiss').addEventListener('click', () => {
    window.sdk.dismiss("ad-slot");
    addLog('üóëÔ∏è ƒê√£ dismiss qu·∫£ng c√°o');
    showStatus('status-static', 'success', 'ƒê√£ x√≥a qu·∫£ng c√°o');
  });
  
  // Video pause/play handling
  const video = document.getElementById('video-demo');
  const videoAdSlot = document.getElementById('video-ad-slot');
  let isSeeking = false;
  let pauseTimeout = null;
  
  video.addEventListener('seeking', () => {
    isSeeking = true;
  });
  
  video.addEventListener('seeked', () => {
    setTimeout(() => {
      isSeeking = false;
    }, 100);
  });
  
  video.addEventListener('pause', () => {
    if (isSeeking) return;
    
    clearTimeout(pauseTimeout);
    pauseTimeout = setTimeout(() => {
      if (!video.paused || isSeeking) return;
      
      addLog('‚è∏Ô∏è Video paused - ƒêang t·∫£i overlay banner...');
      
      // Show overlay ad with callback
      window.sdk.start("video-ad-slot", "OVERLAY", "PAUSE_BANNER", (result) => {
        console.log('üì¶ Video Ad Callback:', result);
        
        if (result.status === 'success') {
          addLog(`‚úÖ Overlay banner hi·ªÉn th·ªã! (domId: ${result.domId})`, 'success');
          showStatus('status-video', 'success', '‚úÖ Overlay banner ƒë√£ ƒë∆∞·ª£c t·∫£i');
          
          // Show the ad slot
          videoAdSlot.style.opacity = '1';
          videoAdSlot.style.pointerEvents = 'auto';
          
        } else if (result.status === 'error') {
          addLog(`‚ùå L·ªói overlay: ${result.error.message}`, 'error');
          showStatus('status-video', 'error', `‚ùå ${result.error.message}`);
          
        } else if (result.status === 'delay') {
          addLog(`‚è≥ Overlay trong delay: ${result.data.remainingSeconds}s`, 'delay');
          showStatus('status-video', 'delay', `‚è≥ ƒê·ª£i ${result.data.remainingSeconds}s`);
        }
      });
    }, 150);
  });
  
  video.addEventListener('play', () => {
    addLog('‚ñ∂Ô∏è Video playing - ·∫®n overlay');
    videoAdSlot.style.opacity = '0';
    videoAdSlot.style.pointerEvents = 'none';
    window.sdk.dismiss("video-ad-slot");
  });
  
  // Listen to SDK events
  window.sdk.on('rendered', (data) => {
    addLog(`üé® Event: Ad rendered (domId: ${data.domId})`);
  });
  
  window.sdk.on('click', (data) => {
    addLog(`üëÜ Event: Ad clicked (domId: ${data.domId})`);
  });
  
  window.sdk.on('skip', (data) => {
    addLog(`‚è≠Ô∏è Event: Ad skipped (domId: ${data.domId})`);
  });
  
  window.sdk.on('error', (data) => {
    addLog(`üö® Event: Error occurred (domId: ${data.domId})`, 'error');
  });
  
  // Initial log
  addLog('üöÄ Demo ready! Click "T·∫£i Qu·∫£ng C√°o" ƒë·ªÉ b·∫Øt ƒë·∫ßu');
</script>
</body>
</html>